<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vidushi AI Builder - 2.5 Flash</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #6366f1; --accent: #f43f5e; --bg: #0f172a; --glass: rgba(30, 41, 59, 0.7); }
        
        body { background: var(--bg); color: white; font-family: 'Poppins', sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; padding: 20px; position: relative; overflow-x: hidden; }

        /* àªµàª¿àª¡à«€àª¯à«‹ àª¬à«‡àª•àª—à«àª°àª¾àª‰àª¨à«àª¡ àª¸à«àªŸàª¾àªˆàª²àª¿àª‚àª— */
        #video-background { position: fixed; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: -1; opacity: 0.25; pointer-events: none; }

        /* àª®à«‡àªˆàª¨ àª•àª¾àª°à«àª¡ UI */
        .glass-card { background: var(--glass); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 28px; padding: 25px; width: 100%; max-width: 750px; box-shadow: 0 25px 50px rgba(0,0,0,0.6); z-index: 1; }

        .settings-icon { position: absolute; top: 25px; right: 25px; font-size: 26px; cursor: pointer; color: #94a3b8; transition: 0.4s; z-index: 10; }
        .settings-icon:hover { color: white; transform: rotate(90deg); }

        h1 { font-size: 2.2rem; margin: 0; background: linear-gradient(to right, #a5b4fc, #fb7185); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 800; }
        p { color: #94a3b8; margin-top: 5px; font-size: 14px; letter-spacing: 1px; }

        .input-box { width: 100%; height: 90px; background: rgba(15, 23, 42, 0.6); border: 2px solid #334155; border-radius: 18px; padding: 15px; color: #34d399; font-size: 16px; margin-top: 20px; outline: none; transition: 0.3s; box-sizing: border-box; resize: none; }
        .input-box:focus { border-color: var(--primary); box-shadow: 0 0 15px rgba(99, 102, 241, 0.2); }

        .controls { display: flex; gap: 12px; margin-top: 15px; }
        .btn { flex: 1; padding: 16px; border: none; border-radius: 14px; font-weight: bold; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 16px; }
        .btn-build { background: linear-gradient(45deg, #4f46e5, #6366f1); color: white; }
        .btn-build:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(79, 70, 229, 0.4); }
        .btn-mic { background: #1e293b; color: white; width: 65px; flex: 0; font-size: 20px; }
        .btn-mic.listening { background: var(--accent); animation: pulse 1.5s infinite; }

        #status { margin: 15px 0; font-size: 14px; color: #cbd5e1; height: 20px; }

        /* àª°àª¿àª‚àª—àª° àªàª°àª¿àª¯àª¾ àªœà«àª¯àª¾àª‚ àªàªª àª¦à«‡àª–àª¾àª¶à«‡ */
        #renderArea { width: 100%; height: 500px; background: white; border-radius: 20px; margin-top: 20px; border: 6px solid #1e293b; overflow: hidden; box-shadow: inset 0 0 10px rgba(0,0,0,0.2); }
        iframe { width: 100%; height: 100%; border: none; }

        /* àª¸à«‡àªŸàª¿àª‚àª—à«àª¸ àª®à«‹àª¡àª² */
        #settingsModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 100; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-content { background: #1e293b; padding: 35px; border-radius: 24px; width: 90%; max-width: 400px; text-align: center; border: 1px solid var(--primary); }
        .modal-content input { width: 100%; padding: 14px; margin: 15px 0; border-radius: 12px; border: 1px solid #334155; background: #0f172a; color: #34d399; outline: none; box-sizing: border-box; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.08); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <video autoplay loop muted playsinline id="video-background">
        <source src="videos/smiling_video.mp4" type="video/mp4">
    </video>

    <i class="fas fa-cog settings-icon" onclick="openSettings()"></i>

    <div class="glass-card">
        <center>
            <h1>àªµàª¿àª¦à«àª·à«€ AI àª¬àª¿àª²à«àª¡àª° ğŸ¤–</h1>
            <p>GEMINI 2.5 FLASH POWERED</p>
        </center>

        <textarea id="userCommand" class="input-box" placeholder="àª¤àª®àª¾àª°à«‹ àª†àª¦à«‡àª¶ àª†àªªà«‹... (àª¦àª¾.àª¤. 'àªàª• àª•à«‡àª²à«àª•à«àª¯à«àª²à«‡àªŸàª° àª¬àª¨àª¾àªµà«‹')"></textarea>
        
        <div class="controls">
            <button id="micBtn" class="btn btn-mic" onclick="toggleMic()">
                <i class="fas fa-microphone"></i>
            </button>
            <button class="btn btn-build" onclick="buildApp()">
                àªàªª àª¬àª¨àª¾àªµà«‹ <i class="fas fa-magic"></i>
            </button>
        </div>

        <div id="status">Ready to build your ideas...</div>
        
        <div id="renderArea">
            <iframe id="appFrame"></iframe>
        </div>
    </div>

    <div id="settingsModal">
        <div class="modal-content">
            <h3 style="margin-top:0;"><i class="fas fa-key"></i> API àª¸à«‡àªŸàª¿àª‚àª—à«àª¸</h3>
            <p style="font-size: 12px; color: #94a3b8;">Gemini 2.5 Flash API Key àª…àª¹à«€àª‚ àª¸à«‡àªµ àª•àª°à«‹</p>
            <input type="password" id="apiKeyInput" placeholder="API Key àª…àª¹à«€àª‚ àªªà«‡àª¸à«àªŸ àª•àª°à«‹...">
            <button class="btn btn-build" onclick="saveSettings()">àª¸à«‡àªµ àª•àª°à«‹</button>
            <button style="background:none; border:none; color:#f43f5e; margin-top:15px; cursor:pointer; font-weight:bold;" onclick="closeSettings()">àª¬àª‚àª§ àª•àª°à«‹</button>
        </div>
    </div>

    <script>
        // à«§. àªµàª¿àª¡à«€àª¯à«‹ àª¸à«‹àª°à«àª¸ àª•à«‹àª¨à«àª«àª¿àª—àª°à«‡àª¶àª¨
        const videoBg = document.getElementById('video-background');
        const videoSources = {
            'smiling': 'videos/smiling_video.mp4',
            'thinking': 'videos/thinking_video.mp4',
            'talking': 'videos/talking_video.mp4',
            'silent': 'videos/silent_video.mp4'
        };

        function playVideo(state) {
            if (videoSources[state]) {
                videoBg.src = videoSources[state];
                videoBg.load();
                videoBg.play().catch(e => console.log("Video wait..."));
            }
        }

        // à«¨. àª¸à«‡àªŸàª¿àª‚àª—à«àª¸ àª®à«‡àª¨à«‡àªœàª®à«‡àª¨à«àªŸ
        function openSettings() { document.getElementById('settingsModal').style.display = 'flex'; }
        function closeSettings() { document.getElementById('settingsModal').style.display = 'none'; }
        
        function saveSettings() {
            const key = document.getElementById('apiKeyInput').value.trim();
            if (key) {
                localStorage.setItem('gemini_api_key', key);
                alert("API Key àª¸à«àª°àª•à«àª·àª¿àª¤ àª°à«€àª¤à«‡ àª¸à«‡àªµ àª¥àªˆ àª—àªˆ àª›à«‡!");
                closeSettings();
            }
        }

        // à«©. àªµà«‹àªˆàª¸ àª°à«‡àª•àª—à«àª¨àª¿àª¶àª¨ (Mic)
        function toggleMic() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) { alert("Mic àª¸àªªà«‹àª°à«àªŸ àª‰àªªàª²àª¬à«àª§ àª¨àª¥à«€"); return; }
            
            const recognition = new SpeechRecognition();
            recognition.lang = 'gu-IN';

            recognition.onstart = () => { 
                playVideo('talking'); 
                document.getElementById('micBtn').classList.add('listening'); 
            };
            recognition.onend = () => { 
                playVideo('smiling'); 
                document.getElementById('micBtn').classList.remove('listening'); 
            };
            recognition.onresult = (e) => { 
                document.getElementById('userCommand').value = e.results[0][0].transcript; 
            };
            recognition.start();
        }

        // à«ª. Gemini 2.5 Flash API àª•à«‹àª²
        async function buildApp() {
            const savedKey = localStorage.getItem('gemini_api_key');
            if (!savedKey) {
                alert("àªªàª¹à«‡àª²àª¾ àª¸à«‡àªŸàª¿àª‚àª—à«àª¸àª®àª¾àª‚ API Key àª¨àª¾àª–à«‹");
                openSettings();
                return;
            }

            const command = document.getElementById('userCommand').value.trim();
            const status = document.getElementById('status');
            const frame = document.getElementById('appFrame');

            if (!command) return;

            status.innerHTML = "â³ <span style='color: #fbbf24;'>àªµàª¿àª¦à«àª·à«€ à«¨.à«« àª«à«àª²à«‡àª¶ àª•à«‹àª¡àª¿àª‚àª— àª•àª°à«€ àª°àª¹à«€ àª›à«‡...</span>";
            playVideo('thinking');

            const URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${savedKey}`;

            try {
                const response = await fetch(URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `Act as a senior developer. Build a single-file professional HTML/CSS/JS solution for: ${command}. Provide ONLY the final code code starting with <!DOCTYPE html>. No explanation text.` }] }]
                    })
                });

                const data = await response.json();
                
                if (data.error) {
                    status.innerHTML = "âŒ àª­à«‚àª²: " + data.error.message;
                    playVideo('silent');
                    return;
                }

                let aiCode = data?.candidates?.[0]?.content?.parts?.[0]?.text;

                if (aiCode) {
                    aiCode = aiCode.replace(/```html/g, "").replace(/```javascript/g, "").replace(/```css/g, "").replace(/```/g, "").trim();
                    status.innerHTML = "âœ… àª¤àª®àª¾àª°à«€ àªàªª àª¤à«ˆàª¯àª¾àª° àª›à«‡!";
                    playVideo('smiling');
                    
                    const doc = frame.contentWindow.document;
                    doc.open();
                    doc.write(aiCode);
                    doc.close();
                } else {
                    status.innerHTML = "âŒ àª°àª¿àª¸à«àªªà«‹àª¨à«àª¸àª®àª¾àª‚ àª•à«‹àª¡ àª®àª³à«àª¯à«‹ àª¨àª¥à«€";
                    playVideo('silent');
                }
            } catch (err) {
                status.innerHTML = "âŒ àª¨à«‡àªŸàªµàª°à«àª• àªàª°àª° àª†àªµà«€ àª›à«‡";
                playVideo('silent');
            }
        }

        window.onload = () => playVideo('smiling');
    </script>
</body>
</html>
