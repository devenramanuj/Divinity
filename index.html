<!DOCTYPE html>
<html lang="gu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Devinity</title>

<style>
body{margin:0;font-family:system-ui;background:#f4f6f8}
header{background:#2c3e90;color:#fff;padding:12px;text-align:center}
.topbar{display:flex;justify-content:space-between;background:#e9ecff;padding:8px}
.icon-btn{background:none;border:none;font-size:22px}
#chatBox{height:55vh;overflow-y:auto;padding:12px;background:#fff}
.msg{margin-bottom:10px}
.user{text-align:right;color:#2c3e90}
.bot{text-align:left;color:#000}
.controls{display:flex;gap:10px;padding:12px}
.btn{flex:1;padding:12px;font-size:16px;border:none;color:#fff;border-radius:6px}
.green{background:#1e8449}
.red{background:#c0392b}
#settings{display:none;padding:12px}
input,select{width:100%;padding:8px;margin-bottom:10px}
</style>
</head>

<body>

<header>Devinity</header>

<div class="topbar">
  <button class="icon-btn" onclick="showChat()">ğŸ’¬</button>
  <button class="icon-btn" onclick="showSettings()">âš™ï¸</button>
</div>

<div id="chat">
  <div id="chatBox"></div>
  <div class="controls">
    <button class="btn green" onclick="startListening()">ğŸ¤ àª¬à«‹àª²à«‹</button>
    <button class="btn red" onclick="stopListening()">â¹ï¸ àª°à«‹àª•à«‹</button>
  </div>
</div>

<div id="settings">
  <h3>Settings</h3>

  <label>API Key</label>
  <input id="apiKey" placeholder="Paste API key" />

  <label>Model</label>
  <select id="model">
    <option value="openai:gpt-4o-mini">OpenAI â€“ GPT-4o Mini</option>
    <option value="groq:llama3-70b-8192">Groq â€“ LLaMA-3 70B</option>
    <option value="gemini:gemini-2.5-flash">Gemini â€“ 2.5 Flash</option>
  </select>

  <button class="btn green" onclick="saveSettings()">Save</button>
</div>

<script>
let recognition,isListening=false;
const chatBox=document.getElementById("chatBox");

function addMsg(t,c){const d=document.createElement("div");d.className="msg "+c;d.innerText=t;chatBox.appendChild(d);chatBox.scrollTop=chatBox.scrollHeight}

/* SETTINGS */
apiKey.value=localStorage.getItem("apiKey")||"";
model.value=localStorage.getItem("model")||"openai:gpt-4o-mini";

function saveSettings(){
  localStorage.setItem("apiKey",apiKey.value.trim());
  localStorage.setItem("model",model.value);
  alert("Saved");
}

/* UI */
function showSettings(){chat.style.display="none";settings.style.display="block"}
function showChat(){settings.style.display="none";chat.style.display="block"}

/* SPEECH */
if("webkitSpeechRecognition"in window){
recognition=new webkitSpeechRecognition();
recognition.lang="gu-IN";
recognition.onresult=e=>{
  const t=e.results[0][0].transcript;
  addMsg(t,"user");
  askBot(t);
};
recognition.onend=()=>isListening=false;
}

function startListening(){
  if(!recognition||isListening)return;
  recognition.start();isListening=true;
}
function stopListening(){
  if(recognition&&isListening){recognition.stop();isListening=false}
}

/* BOT ENGINE */
async function askBot(text){
const key=localStorage.getItem("apiKey");
if(!key){addMsg("API key àª¸à«‡àªŸ àª¨àª¥à«€.","bot");return;}

const [provider,modelName]=localStorage.getItem("model").split(":");

try{
let reply="";

if(provider==="openai"){
const r=await fetch("https://api.openai.com/v1/chat/completions",{
method:"POST",
headers:{Authorization:"Bearer "+key,"Content-Type":"application/json"},
body:JSON.stringify({
model:modelName,
messages:[
{role:"system",content:"You are Devinity, a Gujarati speaking female assistant. Reply only in Gujarati. No symbols."},
{role:"user",content:text}
]
})
});
const j=await r.json();
reply=j.choices?.[0]?.message?.content;
}

/* GROQ */
if(provider==="groq"){
const r=await fetch("https://api.groq.com/openai/v1/chat/completions",{
method:"POST",
headers:{Authorization:"Bearer "+key,"Content-Type":"application/json"},
body:JSON.stringify({
model:modelName,
messages:[
{role:"system",content:"Reply only in Gujarati as a female assistant."},
{role:"user",content:text}
]
})
});
const j=await r.json();
reply=j.choices?.[0]?.message?.content;
}

/* GEMINI */
if(provider==="gemini"){
const r=await fetch(
`https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${key}`,
{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
contents:[{parts:[{text:"Gujarati reply only. "+text}]}]
})
});
const j=await r.json();
reply=j.candidates?.[0]?.content?.parts?.[0]?.text;
}

if(!reply){addMsg("àªœàªµàª¾àª¬ àª®àª³à«àª¯à«‹ àª¨àª¥à«€.","bot");return;}
addMsg(reply,"bot");speak(reply);

}catch(e){addMsg("API error àª¥àª¯à«‹.","bot")}
}

function speak(t){
const u=new SpeechSynthesisUtterance(t);
u.lang="gu-IN";u.rate=0.95;
speechSynthesis.speak(u);
}
</script>
</body>
</html>
