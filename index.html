<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vidushi AI - Universal Oracle</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --accent: #f43f5e; --glass: rgba(0, 0, 0, 0.7); }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: 'Poppins', sans-serif; background: black; color: white; }

        /* Full Background Video */
        #video-background { position: fixed; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1; }

        /* Minimal Home Controls */
        .controls-overlay { position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%); display: flex; align-items: center; gap: 20px; z-index: 10; }
        .btn-mic { width: 75px; height: 75px; background: white; color: black; border: none; border-radius: 50%; font-size: 30px; cursor: pointer; box-shadow: 0 0 30px rgba(255,255,255,0.2); transition: 0.3s; }
        .btn-mic.listening { background: var(--accent); color: white; animation: pulse 1.5s infinite; }
        
        .settings-btn { position: fixed; top: 20px; right: 20px; z-index: 10; font-size: 26px; color: rgba(255,255,255,0.6); cursor: pointer; padding: 10px; }

        /* Centered Settings Modal for Mobile */
        #settingsModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 100; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
        .settings-content { background: #1e293b; padding: 30px; border-radius: 28px; width: 85%; max-width: 380px; max-height: 80vh; overflow-y: auto; border: 1px solid rgba(255,255,255,0.1); text-align: center; }
        
        .setting-section { margin-bottom: 25px; text-align: left; }
        h3 { font-size: 13px; color: #818cf8; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px; }
        input, select { width: 100%; padding: 14px; background: #0f172a; border: 1px solid #334155; color: #34d399; border-radius: 12px; margin-bottom: 12px; box-sizing: border-box; outline: none; }
        
        #cameraPreview { width: 100%; height: 200px; background: black; border-radius: 15px; margin-top: 10px; display: none; object-fit: cover; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <video autoplay loop muted playsinline id="video-background">
        <source src="smiling.mp4" type="video/mp4">
    </video>

    <i class="fas fa-cog settings-btn" onclick="toggleSettings()"></i>

    <div class="controls-overlay">
        <button id="micBtn" class="btn-mic" onclick="toggleMic()"><i class="fas fa-microphone"></i></button>
    </div>

    <div id="settingsModal">
        <div class="settings-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
                <h2 style="margin:0; font-size:22px; color:white;">સેટિંગ્સ</h2>
                <i class="fas fa-times" onclick="toggleSettings()" style="cursor:pointer; font-size:22px; color:#94a3b8;"></i>
            </div>

            <div class="setting-section">
                <h3>મોડેલ પસંદ કરો</h3>
                <select id="modelSelect">
                    <option value="gemini">Gemini 2.5 Flash</option>
                    <option value="groq">Groq Llama 3 70B</option>
                </select>
            </div>

            <div class="setting-section">
                <h3>API Keys</h3>
                <input type="password" id="geminiKey" placeholder="Gemini API Key">
                <input type="password" id="groqKey" placeholder="Groq API Key">
                <button onclick="saveAllSettings()" style="width:100%; padding:14px; background: linear-gradient(45deg, #4f46e5, #6366f1); border:none; border-radius:12px; color:white; font-weight:bold; cursor:pointer;">સેવ કરો</button>
            </div>

            <div class="setting-section">
                <h3>Smart Lens (Back Camera)</h3>
                <button onclick="toggleCamera()" style="width:100%; padding:12px; background:#334155; border:none; color:white; border-radius:12px; cursor:pointer;"><i class="fas fa-camera"></i> કેમેરો ઓન/ઓફ</button>
                <video id="cameraPreview" autoplay playsinline></video>
            </div>
        </div>
    </div>

    <script>
        const videoBg = document.getElementById('video-background');
        
        // વિડીયો સ્ટેટ્સ લોજિક - હવે ડાયરેક્ટ ફાઈલ નેમ
        const videoSources = {
            'smiling': 'smiling.mp4',
            'thinking': 'thinking.mp4',
            'talking': 'talking.mp4',
            'silent': 'silent.mp4'
        };

        function playVideo(state) {
            if (videoSources[state]) {
                videoBg.src = videoSources[state];
                videoBg.load();
                videoBg.play().catch(e => console.log("Auto-play blocked"));
            }
        }

        function toggleSettings() {
            const modal = document.getElementById('settingsModal');
            modal.style.display = (modal.style.display === 'flex') ? 'none' : 'flex';
        }

        function saveAllSettings() {
            localStorage.setItem('gemini_key', document.getElementById('geminiKey').value);
            localStorage.setItem('groq_key', document.getElementById('groqKey').value);
            localStorage.setItem('selected_model', document.getElementById('modelSelect').value);
            alert("બધા સેટિંગ્સ સેવ થઈ ગયા છે!");
            toggleSettings();
        }

        async function toggleCamera() {
            const video = document.getElementById('cameraPreview');
            if (video.style.display === 'block') {
                const stream = video.srcObject;
                if(stream) stream.getTracks().forEach(track => track.stop());
                video.style.display = 'none';
            } else {
                try {
                    // Back Camera (facingMode: environment)
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        video: { facingMode: "environment" } 
                    });
                    video.srcObject = stream;
                    video.style.display = 'block';
                } catch (err) {
                    alert("કેમેરો શરૂ કરવામાં સમસ્યા: " + err.message);
                }
            }
        }

        // મિક લોજિક
        function toggleMic() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) { alert("Mic Not Supported"); return; }
            
            const recognition = new SpeechRecognition();
            recognition.lang = 'gu-IN';

            recognition.onstart = () => { 
                playVideo('talking');
                document.getElementById('micBtn').classList.add('listening'); 
            };
            recognition.onend = () => { 
                playVideo('smiling');
                document.getElementById('micBtn').classList.remove('listening'); 
            };
            recognition.onresult = (e) => {
                const command = e.results[0][0].transcript;
                // અહીં તમારું AI પ્રોસેસિંગ ફંક્શન કોલ કરો
                console.log("Command:", command);
            };
            recognition.start();
        }

        // પેજ લોડ વખતે વિડીયો શરૂ કરવો
        window.onload = () => {
            playVideo('smiling');
            // સેવ કરેલી કીઝ સેટિંગ્સમાં બતાવવા
            document.getElementById('geminiKey').value = localStorage.getItem('gemini_key') || '';
            document.getElementById('groqKey').value = localStorage.getItem('groq_key') || '';
            document.getElementById('modelSelect').value = localStorage.getItem('selected_model') || 'gemini';
        };
    </script>
</body>
</html>
