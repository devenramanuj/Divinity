<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vidushi AI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; color: #fff; }
        #mainVideo { position: fixed; inset: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1; opacity: 0.8; }
        .ui-layer { position: absolute; bottom: 80px; left: 0; right: 0; z-index: 100; display: flex; flex-direction: column; align-items: center; }
        .controls { display: flex; gap: 15px; background: rgba(0,0,0,0.7); padding: 15px 30px; border-radius: 50px; backdrop-filter: blur(10px); border: 1px solid #444; }
        .btn { width: 60px; height: 60px; border-radius: 50%; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 24px; transition: transform 0.2s; }
        .btn:hover { transform: scale(1.1); }
        .mic { background: #fff; color: #000; }
        .stop { background: #f44336; color: #fff; width: 50px; height: 50px; margin-top: 5px; }
        .settings-icon { position: fixed; top: 40px; right: 30px; z-index: 100; font-size: 30px; cursor: pointer; transition: transform 0.3s; }
        .settings-icon:hover { transform: rotate(90deg); }
        
        #settingsModal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 1000; align-items: center; justify-content: center; }
        .card { background: #111; width: 90%; max-width: 450px; padding: 30px; border-radius: 20px; border: 2px solid #ff6d00; box-shadow: 0 0 30px rgba(255,109,0,0.3); }
        .card h3 { color: #ff6d00; margin-top: 0; }
        select, textarea, input { width: 100%; padding: 12px; margin: 10px 0; background: #222; border: 1px solid #444; color: #4ade80; border-radius: 8px; box-sizing: border-box; font-family: inherit; }
        select:focus, textarea:focus { outline: none; border-color: #ff6d00; }
        .save { background: #ff6d00; color: #fff; padding: 15px; width: 100%; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 16px; transition: background 0.3s; margin-top: 5px; }
        .save:hover { background: #ff8c00; }
        #mSel { margin-bottom: 10px; }
        .model-info { color: #aaa; font-size: 12px; margin-top: -5px; margin-bottom: 10px; padding: 8px; background: rgba(255,109,0,0.1); border-radius: 5px; }
        .status-indicator { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-right: 8px; }
        .status-listening { background: #4ade80; animation: pulse 1s infinite; }
        .status-thinking { background: #fbbf24; animation: pulse 1s infinite; }
        .status-speaking { background: #3b82f6; animation: pulse 1s infinite; }
        .status-idle { background: #6b7280; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .label { font-size: 14px; color: #aaa; margin-top: 10px; margin-bottom: 5px; }
        .key-status { font-size: 12px; padding: 8px; border-radius: 5px; margin: 5px 0; }
        .key-active { background: rgba(74, 222, 128, 0.2); color: #4ade80; }
        .key-inactive { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
    </style>
</head>
<body>

    <video id="mainVideo" autoplay loop muted playsinline><source src="silent.mp4" type="video/mp4"></video>
    <i class="fas fa-cog settings-icon" onclick="toggleM()"></i>

    <div class="ui-layer">
        <div id="status" style="margin-bottom:15px; font-weight:bold; color:#ffd600;">
            <span class="status-indicator status-idle"></span>àªœàª¯ àª¶à«àª°à«€ àª•à«ƒàª·à«àª£
        </div>
        <div class="controls">
            <button class="btn mic" onclick="startVoice()" title="àª¬à«‹àª²à«‹"><i class="fas fa-microphone"></i></button>
            <button class="btn stop" onclick="stopSpeech()" title="àª¬àª‚àª§ àª•àª°à«‹"><i class="fas fa-stop"></i></button>
        </div>
    </div>

    <div id="settingsModal">
        <div class="card">
            <h3 style="text-align:center;"><i class="fas fa-cog"></i> àª¸à«‡àªŸàª¿àª‚àª—à«àª¸</h3>
            
            <div class="label">ğŸ¤– AI Provider àªªàª¸àª‚àª¦ àª•àª°à«‹:</div>
            <select id="pSel" onchange="updateModels()">
                <option value="gemini">Google Gemini</option>
                <option value="groq">Groq Llama</option>
            </select>
            
            <div class="label">ğŸ“Š Model àªªàª¸àª‚àª¦ àª•àª°à«‹:</div>
            <select id="mSel">
                <!-- Options will be populated dynamically -->
            </select>
            <div id="modelInfo" class="model-info"></div>
            
            <div id="keyStatus" class="key-status"></div>
            
            <button class="save" onclick="saveModel()">ğŸ’¾ SAVE MODEL</button>
            <button class="save" onclick="editKeys()" style="background:#6366f1;">ğŸ”‘ EDIT API KEYS</button>
        </div>
    </div>

    <script>
        // ============================================
        // ğŸ” PERMANENT API KEYS - àª…àª¹à«€àª‚ àª¤àª®àª¾àª°à«€ keys àª¨àª¾àª–à«‹
        // ============================================
        
        const API_KEYS = {
            // Gemini Keys - Multiple keys comma separated
            // Example: "key1,key2,key3"
            gemini: "YOUR_GEMINI_KEY_HERE",
            
            // Groq Key - Single key
            groq: "YOUR_GROQ_KEY_HERE"
        };
        
        // ============================================
        
        const v = document.getElementById('mainVideo');
        let currentGeminiKeyIndex = 0;
        
        const modelOptions = {
            gemini: [
                { id: "gemini-1.5-flash-latest", name: "â­ Gemini 1.5 Flash Latest (Recommended)" },
                { id: "gemini-1.5-flash", name: "Gemini 1.5 Flash" },
                { id: "gemini-1.5-pro-latest", name: "Gemini 1.5 Pro Latest" },
                { id: "gemini-1.5-pro", name: "Gemini 1.5 Pro" },
                { id: "gemini-2.0-flash-exp", name: "ğŸ§ª Gemini 2.0 Flash (Experimental)" }
            ],
            groq: [
                { id: "llama-3.1-8b-instant", name: "â­ Llama 3.1 8B Instant (Recommended)" },
                { id: "llama3-8b-8192", name: "âœ… Llama 3 8B" },
                { id: "mixtral-8x7b-32768", name: "Mixtral 8x7B" },
                { id: "llama-3.3-70b-versatile", name: "âš ï¸ Llama 3.3 70B (Limited)" },
                { id: "llama-3.1-70b-versatile", name: "âš ï¸ Llama 3.1 70B (Limited)" }
            ]
        };
        
        function setV(s) { 
            v.src = s + ".mp4"; 
            v.play().catch(e => console.log("Video play error:", e)); 
        }
        
        function toggleM() { 
            const m = document.getElementById('settingsModal'); 
            m.style.display = m.style.display === 'flex' ? 'none' : 'flex';
            updateKeyStatus();
        }
        
        function updateKeyStatus() {
            const provider = document.getElementById('pSel').value;
            const keyStatusDiv = document.getElementById('keyStatus');
            
            let keys;
            if (provider === 'gemini') {
                keys = API_KEYS.gemini.split(',').map(k => k.trim()).filter(k => k && k !== 'YOUR_GEMINI_KEY_HERE');
            } else {
                keys = API_KEYS.groq && API_KEYS.groq !== 'YOUR_GROQ_KEY_HERE' ? [API_KEYS.groq] : [];
            }
            
            if (keys.length > 0) {
                if (provider === 'gemini') {
                    keyStatusDiv.className = 'key-status key-active';
                    keyStatusDiv.innerHTML = `âœ… ${keys.length} Gemini API Key${keys.length > 1 ? 's' : ''} Active`;
                } else {
                    keyStatusDiv.className = 'key-status key-active';
                    keyStatusDiv.innerHTML = `âœ… Groq API Key Active`;
                }
            } else {
                keyStatusDiv.className = 'key-status key-inactive';
                keyStatusDiv.innerHTML = `âš ï¸ API Key àª¨àª¥à«€! àª•à«‹àª¡àª®àª¾àª‚ keys àª¨àª¾àª–à«‹`;
            }
        }
        
        function updateModels() {
            const provider = document.getElementById('pSel').value;
            const modelSelect = document.getElementById('mSel');
            const modelInfo = document.getElementById('modelInfo');
            
            modelSelect.innerHTML = '';
            
            modelOptions[provider].forEach(model => {
                const option = document.createElement('option');
                option.value = model.id;
                option.textContent = model.name;
                modelSelect.appendChild(option);
            });
            
            if (provider === 'gemini') {
                modelInfo.innerHTML = "ğŸ’¡ <strong>Tip:</strong> Flash Latest àª¸à«Œàª¥à«€ àª¸àª¾àª°à«àª‚ àª…àª¨à«‡ àªàª¡àªªà«€ àª›à«‡<br>ğŸ”„ Multiple keys automatic rotate àª¥àª¾àª¯ àª›à«‡";
            } else {
                modelInfo.innerHTML = "ğŸ’¡ <strong>Tip:</strong> 8B models àªàª¡àªªà«€ àª…àª¨à«‡ reliable àª›à«‡<br>70B models free tier àª®àª¾àª‚ limited àª›à«‡";
            }
            
            updateKeyStatus();
        }
        
        function editKeys() {
            alert("ğŸ”‘ API Keys Edit àª•àª°àªµàª¾ àª®àª¾àªŸà«‡:\n\n1. HTML file àª¨à«‡ text editor àª®àª¾àª‚ àª–à«‹àª²à«‹\n2. Lines 67-73 àªªàª° API_KEYS section àª¶à«‹àª§à«‹\n3. àª¤àª®àª¾àª°à«€ keys paste àª•àª°à«‹:\n   - Gemini: \"key1,key2,key3\"\n   - Groq: \"your_key\"\n4. File save àª•àª°à«‹ àª…àª¨à«‡ refresh àª•àª°à«‹");
        }
        
        function getApiKey(provider) {
            if (provider === 'gemini') {
                const keys = API_KEYS.gemini.split(',').map(k => k.trim()).filter(k => k && k !== 'YOUR_GEMINI_KEY_HERE');
                
                if (keys.length === 0) {
                    return null;
                }
                
                // Rotate through keys
                const key = keys[currentGeminiKeyIndex % keys.length];
                currentGeminiKeyIndex++;
                
                console.log(`ğŸ”‘ Using Gemini Key ${(currentGeminiKeyIndex - 1) % keys.length + 1} of ${keys.length}`);
                return key;
            } else {
                if (API_KEYS.groq === 'YOUR_GROQ_KEY_HERE' || !API_KEYS.groq) {
                    return null;
                }
                return API_KEYS.groq;
            }
        }
        
        function updateStatus(text, statusClass) {
            const statusDiv = document.getElementById('status');
            const indicator = statusDiv.querySelector('.status-indicator');
            indicator.className = 'status-indicator ' + statusClass;
            statusDiv.innerHTML = '<span class="status-indicator ' + statusClass + '"></span>' + text;
        }
        
        function speak(t) {
            window.speechSynthesis.cancel();
            const m = new SpeechSynthesisUtterance(t);
            m.lang = 'gu-IN';
            m.rate = 0.9;
            m.pitch = 1.1;
            
            m.onstart = () => { 
                setV("talking"); 
                updateStatus("àª¬à«‹àª²à«€ àª°àª¹à«€ àª›à«àª‚...", "status-speaking");
            };
            m.onend = () => { 
                setV("silent"); 
                updateStatus("àªœàª¯ àª¶à«àª°à«€ àª•à«ƒàª·à«àª£", "status-idle");
            };
            window.speechSynthesis.speak(m);
        }
        
        async function callAI(q) {
            const p = document.getElementById('pSel').value;
            const m = document.getElementById('mSel').value;
            const k = getApiKey(p);
            
            console.log("ğŸ” Debug Info:");
            console.log("Provider:", p);
            console.log("Model:", m);
            console.log("API Key available:", k ? "Yes" : "No");
            
            if (!k) {
                const msg = "âš ï¸ API Key àª¨àª¥à«€! HTML file àª®àª¾àª‚ keys àª¨àª¾àª–à«‹ (Settings â†’ Edit API Keys)";
                speak(msg);
                updateStatus(msg, "status-idle");
                return msg;
            }
            
            try {
                if (p === 'groq') {
                    console.log("ğŸ“¡ Calling Groq API...");
                    
                    const r = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                        method: 'POST',
                        headers: { 
                            'Authorization': `Bearer ${k}`, 
                            'Content-Type': 'application/json' 
                        },
                        body: JSON.stringify({ 
                            model: m, 
                            messages: [
                                {
                                    role: "system",
                                    content: "àª¤àª®à«‡ àªàª• àª®àª¦àª¦àª°à«‚àªª AI assistant àª›à«‹. àª¹àª‚àª®à«‡àª¶àª¾ àª—à«àªœàª°àª¾àª¤à«€àª®àª¾àª‚ àªœàªµàª¾àª¬ àª†àªªà«‹. àª¸àª‚àª•à«àª·àª¿àªªà«àª¤ àª…àª¨à«‡ àª¸à«àªªàª·à«àªŸ àªœàªµàª¾àª¬ àª†àªªà«‹."
                                },
                                { 
                                    role: "user", 
                                    content: q
                                }
                            ],
                            temperature: 0.7,
                            max_tokens: 500
                        })
                    });
                    
                    console.log("ğŸ“¥ Groq Response status:", r.status);
                    
                    if (!r.ok) {
                        const errorText = await r.text();
                        console.error("âŒ Groq Error Response:", errorText);
                        
                        let errorMsg;
                        try {
                            const error = JSON.parse(errorText);
                            errorMsg = error.error?.message || errorText;
                        } catch {
                            errorMsg = errorText;
                        }
                        
                        if (r.status === 401) {
                            errorMsg = "ğŸ”‘ API Key àª–à«‹àªŸà«€ àª›à«‡! àª¨àªµà«€ key HTML àª®àª¾àª‚ àª¨àª¾àª–à«‹";
                        } else if (r.status === 429) {
                            errorMsg = "â±ï¸ Rate limit àªªà«‚àª°à«€ àª¥àªˆ! àª¥à«‹àª¡à«€àªµàª¾àª° àªªàª›à«€ try àª•àª°à«‹";
                        } else if (r.status === 400) {
                            errorMsg = "âš ï¸ Model unavailable! àª¬à«€àªœà«àª‚ model select àª•àª°à«‹ (8B recommend àª›à«‡)";
                        }
                        
                        speak(errorMsg);
                        updateStatus("àª­à«‚àª²: " + errorMsg, "status-idle");
                        return errorMsg;
                    }
                    
                    const d = await r.json();
                    console.log("âœ… Groq Success Response");
                    
                    const answer = d.choices[0]?.message?.content || "àªœàªµàª¾àª¬ àª®àª³à«àª¯à«‹ àª¨àª¥à«€";
                    return answer;
                    
                } else {
                    console.log("ğŸ“¡ Calling Gemini API...");
                    
                    const url = `https://generativelanguage.googleapis.com/v1beta/models/${m}:generateContent?key=${k}`;
                    
                    const requestBody = {
                        contents: [{ 
                            parts: [{ 
                                text: q + "\n\n(àª•à«ƒàªªàª¾ àª•àª°à«€àª¨à«‡ àª—à«àªœàª°àª¾àª¤à«€àª®àª¾àª‚ àªœàªµàª¾àª¬ àª†àªªà«‹, 150 àª¶àª¬à«àª¦à«‹àª®àª¾àª‚)"
                            }] 
                        }],
                        generationConfig: {
                            temperature: 0.7,
                            maxOutputTokens: 500,
                            topP: 0.8,
                            topK: 40
                        }
                    };
                    
                    const r = await fetch(url, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(requestBody)
                    });
                    
                    console.log("ğŸ“¥ Gemini Response status:", r.status);
                    
                    if (!r.ok) {
                        const errorText = await r.text();
                        console.error("âŒ Gemini Error Response:", errorText);
                        
                        let errorMsg = "Gemini API Error";
                        try {
                            const error = JSON.parse(errorText);
                            errorMsg = error.error?.message || errorText;
                        } catch (e) {}
                        
                        if (r.status === 400) {
                            if (errorMsg.includes("API key")) {
                                errorMsg = "ğŸ”‘ API Key àª–à«‹àªŸà«€ àª›à«‡! HTML àª®àª¾àª‚ àª¸àª¾àªšà«€ key àª¨àª¾àª–à«‹";
                            } else if (errorMsg.includes("model")) {
                                errorMsg = "âš ï¸ àª† model available àª¨àª¥à«€! gemini-1.5-flash-latest àªµàª¾àªªàª°à«‹";
                            } else {
                                errorMsg = "âš ï¸ Request invalid: " + errorMsg.substring(0, 100);
                            }
                        } else if (r.status === 403) {
                            errorMsg = "ğŸš« API Key àª¨à«‡ permission àª¨àª¥à«€! àª¨àªµà«€ key àª¬àª¨àª¾àªµà«‹";
                        } else if (r.status === 429) {
                            errorMsg = "â±ï¸ Quota àªªà«‚àª°à«‹ àª¥àª¯à«‹! àª†àª—àª²à«€ key try àª•àª°à«€ àª°àª¹à«àª¯àª¾ àª›à«€àª...";
                            console.log("ğŸ”„ Switching to next Gemini key...");
                            // Retry with next key
                            return await callAI(q);
                        } else if (r.status === 404) {
                            errorMsg = "âŒ Model àª¨àª¥à«€ àª®àª³à«àª¯à«àª‚! gemini-1.5-flash-latest try àª•àª°à«‹";
                        }
                        
                        speak(errorMsg);
                        updateStatus("àª­à«‚àª²: " + errorMsg, "status-idle");
                        return errorMsg;
                    }
                    
                    const d = await r.json();
                    console.log("âœ… Gemini Success Response");
                    
                    if (d.candidates?.[0]?.finishReason === 'SAFETY') {
                        const msg = "âš ï¸ àª¸àª¾àª®àª—à«àª°à«€ safety filters àª¦à«àªµàª¾àª°àª¾ block àª¥àªˆ";
                        speak(msg);
                        return msg;
                    }
                    
                    const answer = d.candidates?.[0]?.content?.parts?.[0]?.text || "àªœàªµàª¾àª¬ àª®àª³à«àª¯à«‹ àª¨àª¥à«€";
                    return answer;
                }
            } catch(e) { 
                console.error("âŒ Network/Fetch Error:", e);
                const errorMsg = `ğŸŒ àª¨à«‡àªŸàªµàª°à«àª• àª­à«‚àª²: ${e.message}`;
                speak(errorMsg);
                updateStatus(errorMsg, "status-idle");
                return errorMsg; 
            }
        }
        
        function startVoice() {
            if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) {
                alert("âš ï¸ àª¤àª®àª¾àª°à«àª‚ àª¬à«àª°àª¾àª‰àªàª° àª¸à«àªªà«€àªš àª°à«‡àª•à«‹àª—à«àª¨àª¿àª¶àª¨ àª¸àªªà«‹àª°à«àªŸ àª•àª°àª¤à«àª‚ àª¨àª¥à«€! Chrome àª…àª¥àªµàª¾ Edge àªµàª¾àªªàª°à«‹.");
                return;
            }
            
            const SpeechRecognition = window.webkitSpeechRecognition || window.SpeechRecognition;
            const rec = new SpeechRecognition();
            rec.lang = 'gu-IN';
            rec.continuous = false;
            rec.interimResults = false;
            rec.maxAlternatives = 1;
            
            rec.onstart = () => { 
                console.log("ğŸ¤ Speech recognition started");
                updateStatus("àª¸àª¾àª‚àª­àª³à«àª‚ àª›à«àª‚... àª¬à«‹àª²à«‹!", "status-listening");
            };
            
            rec.onerror = (event) => {
                console.error("âŒ Speech recognition error:", event.error);
                let errorMsg = "àª­à«‚àª² àª¥àªˆ: ";
                
                switch(event.error) {
                    case 'no-speech':
                        errorMsg += "àª•àª‚àªˆ àª¸àª‚àª­àª³àª¾àª¯à«àª‚ àª¨àª¹à«€àª‚";
                        break;
                    case 'audio-capture':
                        errorMsg += "àª®àª¾àª‡àª•à«àª°à«‹àª«à«‹àª¨ access àª¨àª¥à«€";
                        break;
                    case 'not-allowed':
                        errorMsg += "àª®àª¾àª‡àª•à«àª°à«‹àª«à«‹àª¨ permission àª†àªªà«‹";
                        break;
                    default:
                        errorMsg += event.error;
                }
                
                updateStatus(errorMsg, "status-idle");
                setV("silent");
            };
            
            rec.onresult = async (e) => {
                const q = e.results[0][0].transcript;
                const confidence = e.results[0][0].confidence;
                
                console.log("ğŸ—£ï¸ Recognized:", q);
                console.log("ğŸ“Š Confidence:", confidence);
                
                updateStatus(`àªªà«àª°àª¶à«àª¨: ${q}`, "status-thinking");
                setV("thinking");
                
                updateStatus("àªµàª¿àªšàª¾àª°à«€ àª°àª¹à«€ àª›à«àª‚...", "status-thinking");
                
                const res = await callAI(q);
                
                if (res && !res.includes("àª­à«‚àª²") && !res.includes("Error")) {
                    speak(res);
                } else {
                    updateStatus(res, "status-idle");
                    setV("silent");
                }
            };
            
            rec.onend = () => {
                console.log("ğŸ¤ Speech recognition ended");
            };
            
            try {
                rec.start();
            } catch(e) {
                console.error("Failed to start recognition:", e);
                alert("âš ï¸ àª®àª¾àª‡àª•à«àª°à«‹àª«à«‹àª¨ start àª¨àª¥à«€ àª¥àª¯à«‹! Permission check àª•àª°à«‹.");
            }
        }
        
        function stopSpeech() { 
            window.speechSynthesis.cancel(); 
            setV("silent"); 
            updateStatus("àªœàª¯ àª¶à«àª°à«€ àª•à«ƒàª·à«àª£", "status-idle");
        }
        
        function saveModel() {
            const provider = document.getElementById('pSel').value;
            const model = document.getElementById('mSel').value;
            
            localStorage.setItem('v_p', provider); 
            localStorage.setItem('v_m', model);
            
            toggleM(); 
            alert("âœ… Model àª¸à«‡àªŸàª¿àª‚àª—à«àª¸ àª¸à«‡àªµ àª¥àªˆ àª—àªˆ!");
        }
        
        window.onload = () => {
            console.log("ğŸš€ Vidushi AI Initialized - Permanent Keys Version");
            
            const savedProvider = localStorage.getItem('v_p') || 'groq';
            const savedModel = localStorage.getItem('v_m') || 'llama-3.1-8b-instant';
            
            document.getElementById('pSel').value = savedProvider;
            updateModels();
            
            setTimeout(() => {
                const modelSelect = document.getElementById('mSel');
                const modelExists = Array.from(modelSelect.options).some(opt => opt.value === savedModel);
                if (modelExists) {
                    modelSelect.value = savedModel;
                }
            }, 10);
            
            setV("silent");
            
            // Check if keys are configured
            const hasGeminiKey = API_KEYS.gemini !== 'YOUR_GEMINI_KEY_HERE' && API_KEYS.gemini;
            const hasGroqKey = API_KEYS.groq !== 'YOUR_GROQ_KEY_HERE' && API_KEYS.groq;
            
            if (!hasGeminiKey && !hasGroqKey) {
                setTimeout(() => {
                    alert("âš ï¸ API Keys àª¨àª¥à«€!\n\n1. HTML file text editor àª®àª¾àª‚ àª–à«‹àª²à«‹\n2. Lines 67-73 àªªàª° àª¤àª®àª¾àª°à«€ keys àª¨àª¾àª–à«‹\n3. File save àª•àª°à«€ refresh àª•àª°à«‹");
                }, 500);
            }
        };
    </script>
</body>
</html>
