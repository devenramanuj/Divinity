<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vidushi AI Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; color: #fff; font-family: 'Segoe UI', sans-serif; }
        
        /* Background Video */
        #mainVideo { position: fixed; inset: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1; opacity: 0.7; }
        
        /* UI Overlay */
        .ui-layer { position: absolute; bottom: 20px; left: 0; right: 0; z-index: 100; display: flex; flex-direction: column; align-items: center; pointer-events: none; }
        .ui-layer > * { pointer-events: auto; }
        
        /* Status Bar */
        .status-bar { background: rgba(0,0,0,0.6); padding: 8px 20px; border-radius: 20px; margin-bottom: 15px; backdrop-filter: blur(5px); border: 1px solid #333; font-size: 14px; text-align: center; min-width: 200px; }
        
        /* Controls */
        .controls { display: flex; gap: 15px; background: rgba(20,20,20,0.8); padding: 15px 25px; border-radius: 40px; backdrop-filter: blur(15px); border: 1px solid #444; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        .btn { width: 55px; height: 55px; border-radius: 50%; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); background: #333; color: #fff; position: relative; }
        .btn:active { transform: scale(0.9); }
        .btn i { pointer-events: none; }
        
        .mic { background: linear-gradient(135deg, #00c6ff, #0072ff); width: 70px; height: 70px; font-size: 26px; box-shadow: 0 0 15px rgba(0, 198, 255, 0.5); }
        .mic.listening { animation: pulse-mic 1.5s infinite; }
        
        .stop { background: #ff4757; }
        
        .camera-btn { background: #2ed573; }
        .notes-btn { background: #ffa502; }
        .settings-btn { background: #57606f; }

        @keyframes pulse-mic {
            0% { box-shadow: 0 0 0 0 rgba(0, 198, 255, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(0, 198, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 198, 255, 0); }
        }

        /* Top Settings Icon */
        .top-icon { position: fixed; top: 20px; right: 20px; z-index: 100; font-size: 28px; cursor: pointer; background: rgba(0,0,0,0.5); width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(5px); border: 1px solid #444; }

        /* Modals */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 200; flex-direction: column; align-items: center; justify-content: center; backdrop-filter: blur(10px); opacity: 0; transition: opacity 0.3s; }
        .modal.active { display: flex; opacity: 1; }
        
        .card { background: #1e1e1e; width: 90%; max-width: 500px; padding: 25px; border-radius: 20px; border: 1px solid #333; box-shadow: 0 20px 50px rgba(0,0,0,0.5); max-height: 80vh; overflow-y: auto; }
        
        h3 { margin-top: 0; color: #ff6b6b; text-align: center; }
        .label { font-size: 13px; color: #888; margin-top: 10px; margin-bottom: 5px; display: block; }
        
        select, input, textarea { width: 100%; padding: 12px; margin: 8px 0; background: #2f3542; border: 1px solid #444; color: #fff; border-radius: 8px; box-sizing: border-box; font-family: inherit; }
        select:focus, input:focus { outline: none; border-color: #70a1ff; }
        
        .action-btn { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; font-size: 15px; transition: 0.2s; }
        .save-btn { background: #70a1ff; color: #fff; }
        .save-btn:hover { background: #1e90ff; }
        .close-btn { background: #ff4757; color: #fff; margin-top: 15px; }

        /* Camera Specific */
        #cameraVideo { width: 100%; max-height: 60vh; object-fit: cover; border-radius: 10px; background: #000; display: none; }
        #cameraVideo.active { display: block; }
        
        .capture-controls { margin-top: 15px; display: none; justify-content: center; gap: 20px; }
        .capture-controls.active { display: flex; }
        
        .shutter { width: 70px; height: 70px; border-radius: 50%; border: 4px solid #fff; background: transparent; cursor: pointer; }
        .shutter:active { background: rgba(255,255,255,0.5); }

        /* Notes Specific */
        .note-item { background: #2f3542; padding: 10px; margin-bottom: 8px; border-radius: 8px; border-left: 3px solid #ffa502; font-size: 14px; }
        .note-date { font-size: 10px; color: #777; display: block; margin-bottom: 3px; }
        .empty-notes { text-align: center; color: #777; padding: 20px; }

        /* Status Indicator */
        .status-dot { width: 8px; height: 8px; background: #777; border-radius: 50%; display: inline-block; margin-right: 6px; }
        .status-listening { background: #2ed573; box-shadow: 0 0 8px #2ed573; animation: blink 1s infinite; }
        .status-processing { background: #ffa502; animation: blink 0.5s infinite; }
        .status-speaking { background: #1e90ff; }

        @keyframes blink { 50% { opacity: 0.5; } }

        /* Toast Message */
        #toast { position: fixed; top: 80px; left: 50%; transform: translateX(-50%); background: rgba(30,30,30,0.9); padding: 10px 20px; border-radius: 20px; z-index: 300; border: 1px solid #444; display: none; font-size: 14px; }
    </style>
</head>
<body>

    <video id="mainVideo" autoplay loop muted playsinline><source src="silent.mp4" type="video/mp4"></video>
    
    <i class="fas fa-cog top-icon" onclick="toggleSettings()"></i>
    <div id="toast"></div>

    <div class="ui-layer">
        <div class="status-bar" id="statusText">
            <span class="status-dot" id="statusDot"></span> <span id="msg">àªœàª¯ àª¶à«àª°à«€ àª•à«ƒàª·à«àª£</span>
        </div>
        <div class="controls">
            <button class="btn notes-btn" onclick="openNotes()" title="àª¨à«‹àª‚àª§ àª¡àª¾àª¯àª°à«€"><i class="fas fa-book"></i></button>
            <button class="btn camera-btn" onclick="openCamera()" title="àª•à«…àª®à«‡àª°àª¾ / àª²àª¿àªªàª¿ àªµàª¾àª‚àªšàª¨"><i class="fas fa-camera"></i></button>
            <button class="btn mic" id="micBtn" onclick="startVoice()" title="àª¬à«‹àª²à«‹"><i class="fas fa-microphone"></i></button>
            <button class="btn stop" onclick="stopAll()" title="àª¬àª‚àª§ àª•àª°à«‹"><i class="fas fa-stop"></i></button>
        </div>
    </div>

    <!-- SETTINGS MODAL -->
    <div id="settingsModal" class="modal">
        <div class="card">
            <h3>âš™ï¸ àª¸à«‡àªŸàª¿àª‚àª—à«àª¸</h3>
            
            <label class="label">ğŸ¤– AI Provider</label>
            <select id="pSel" onchange="updateModels()">
                <option value="gemini">Google Gemini (àª²àª¿àªªàª¿ àªµàª¾àª‚àªšàª¨ àª®àª¾àªŸà«‡ Best)</option>
                <option value="groq">Groq Llama (àª«àª•à«àª¤ àªµàª¾àª¤àªšà«€àª¤ àª®àª¾àªŸà«‡)</option>
            </select>
            
            <label class="label">ğŸ“Š Model</label>
            <select id="mSel"></select>
            
            <div id="keyInfo" class="label" style="text-align: center; color: #7bed9f; margin-top: 10px;"></div>
            
            <button class="action-btn save-btn" onclick="saveSettings()">ğŸ’¾ àª¸à«‡àªµ àª•àª°à«‹</button>
            <button class="action-btn close-btn" onclick="toggleSettings()">àª¬àª‚àª§ àª•àª°à«‹</button>
        </div>
    </div>

    <!-- CAMERA MODAL -->
    <div id="cameraModal" class="modal">
        <div class="card" style="width: 95%; max-width: 600px; padding: 15px;">
            <h3>ğŸ“· àª¶àª¿àª²àª¾àª²à«‡àª– / àª²àª¿àªªàª¿ àª¸à«àª•à«‡àª¨ àª•àª°à«‹</h3>
            <video id="cameraVideo" autoplay playsinline></video>
            <canvas id="canvas" style="display:none;"></canvas>
            
            <div id="camPlaceholder" style="padding: 40px; text-align: center; color: #777;">
                àª•à«…àª®à«‡àª°àª¾ àªšàª¾àª²à« àª•àª°àªµàª¾ àª®àª¾àªŸà«‡ àª¨à«€àªšà«‡àª¨àª¾ àª¬àªŸàª¨ àªªàª° àª•à«àª²àª¿àª• àª•àª°à«‹.
            </div>

            <div class="capture-controls" id="camControls">
                <button class="btn" onclick="closeCamera()" style="background:#ff4757"><i class="fas fa-times"></i></button>
                <button class="shutter" onclick="captureAndAnalyze()"></button>
                <button class="btn" onclick="switchCamera()" style="background:#fff; color:#000"><i class="fas fa-sync-alt"></i></button>
            </div>
            
            <button class="action-btn" id="startCamBtn" onclick="initCamera()" style="background:#2ed573; margin-top: 10px;">ğŸ¥ àª•à«…àª®à«‡àª°àª¾ àª¶àª°à«‚ àª•àª°à«‹</button>
        </div>
    </div>

    <!-- NOTES MODAL -->
    <div id="notesModal" class="modal">
        <div class="card">
            <h3>ğŸ“’ àª¨à«‹àª‚àª§ àª¡àª¾àª¯àª°à«€</h3>
            <div id="notesList" style="max-height: 40vh; overflow-y: auto;">
                <!-- Notes will appear here -->
            </div>
            <div style="border-top: 1px solid #444; margin-top: 15px; padding-top: 15px;">
                <label class="label">àª¨àªµà«€ àª¨à«‹àª‚àª§ àª‰àª®à«‡àª°à«‹</label>
                <textarea id="manualNote" rows="3" placeholder="àª…àª¹à«€àª‚ àª²àª–à«‹..."></textarea>
                <button class="action-btn save-btn" onclick="addManualNote()">àª‰àª®à«‡àª°à«‹</button>
            </div>
            <button class="action-btn close-btn" onclick="toggleNotes()">àª¬àª‚àª§ àª•àª°à«‹</button>
        </div>
    </div>

    <script>
        // ==========================================
        // ğŸ”‘ CONFIGURATION
        // ==========================================
        const API_KEYS = {
            // Please put your API keys here
            gemini: "YOUR_GEMINI_KEY_HERE", // Required for Camera Analysis
            groq: "YOUR_GROQ_KEY_HERE"
        };

        const MODEL_OPTS = {
            gemini: [
                { id: "gemini-1.5-flash", name: "Gemini 1.5 Flash (àª«àª¾àª¸à«àªŸ & àªµàª¿àªàª¨ àª¸àªªà«‹àª°à«àªŸ)" },
                { id: "gemini-1.5-pro", name: "Gemini 1.5 Pro (àª¹àª¾àªˆ àª•à«àªµà«‹àª²àª¿àªŸà«€)" }
            ],
            groq: [
                { id: "llama-3.1-8b-instant", name: "Llama 3.1 8B Instant" },
                { id: "llama3-70b-8192", name: "Llama 3 70B" }
            ]
        };

        // ==========================================
        // ğŸŒ GLOBAL STATE
        // ==========================================
        let currentProvider = localStorage.getItem('p') || 'gemini';
        let currentModel = localStorage.getItem('m') || 'gemini-1.5-flash';
        let mediaStream = null;
        let facingMode = 'environment'; // Rear camera default
        let notes = JSON.parse(localStorage.getItem('myNotes') || '[]');

        // ==========================================
        // ğŸ® UI LOGIC
        // ==========================================
        const v = document.getElementById('mainVideo');
        const msgEl = document.getElementById('msg');
        const dotEl = document.getElementById('statusDot');
        const micBtn = document.getElementById('micBtn');

        function setVideo(state) {
            // Assuming you have videos like silent.mp4, talking.mp4, thinking.mp4
            // If files are missing, it gracefully fails
            const src = state + ".mp4";
            if(v.src !== src) {
                v.src = src;
                v.play().catch(e => console.log("Video play error:", e));
            }
        }

        function updateStatus(text, type = 'idle') {
            msgEl.textContent = text;
            dotEl.className = 'status-dot';
            
            if(type === 'listening') {
                dotEl.classList.add('status-listening');
                setVideo('thinking'); // Use a subtle video if available
            } else if (type === 'processing') {
                dotEl.classList.add('status-processing');
                setVideo('thinking');
            } else if (type === 'speaking') {
                dotEl.classList.add('status-speaking');
                setVideo('talking');
            } else {
                setVideo('silent');
            }
        }

        function showToast(text) {
            const t = document.getElementById('toast');
            t.textContent = text;
            t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 3000);
        }

        // ==========================================
        // âš™ï¸ SETTINGS
        // ==========================================
        function toggleSettings() {
            const m = document.getElementById('settingsModal');
            m.classList.toggle('active');
            if(m.classList.contains('active')) {
                document.getElementById('pSel').value = currentProvider;
                updateModels();
            }
        }

        function updateModels() {
            const p = document.getElementById('pSel').value;
            const mSel = document.getElementById('mSel');
            mSel.innerHTML = '';
            MODEL_OPTS[p].forEach(mod => {
                const opt = document.createElement('option');
                opt.value = mod.id;
                opt.text = mod.name;
                mSel.appendChild(opt);
            });
            mSel.value = currentModel;
            
            // Update Key Info
            const kDiv = document.getElementById('keyInfo');
            if(API_KEYS[p].includes('YOUR_')) {
                kDiv.textContent = "âš ï¸ API Key àª¹àªœà«€ àª¸à«‡àªŸ àª¥àªˆ àª¨àª¥à«€ (àª•à«‹àª¡àª®àª¾àª‚ àª¨àª¾àª–à«‹)";
                kDiv.style.color = "#ff6b6b";
            } else {
                kDiv.textContent = "âœ… API Key Active";
                kDiv.style.color = "#2ed573";
            }
        }

        function saveSettings() {
            currentProvider = document.getElementById('pSel').value;
            currentModel = document.getElementById('mSel').value;
            localStorage.setItem('p', currentProvider);
            localStorage.setItem('m', currentModel);
            toggleSettings();
            showToast("àª¸à«‡àªŸàª¿àª‚àª—à«àª¸ àª¸à«‡àªµ àª¥àªˆ àª—àªˆ!");
        }

        // ==========================================
        // ğŸ“· CAMERA & ANALYSIS LOGIC
        // ==========================================
        function openCamera() {
            document.getElementById('cameraModal').classList.add('active');
        }

        function closeCamera() {
            stopCamera();
            document.getElementById('cameraModal').classList.remove('active');
        }

        async function initCamera() {
            try {
                if(mediaStream) stopCamera();
                
                const video = document.getElementById('cameraVideo');
                mediaStream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: facingMode },
                    audio: false
                });
                
                video.srcObject = mediaStream;
                video.classList.add('active');
                document.getElementById('camPlaceholder').style.display = 'none';
                document.getElementById('camControls').classList.add('active');
                document.getElementById('startCamBtn').style.display = 'none';
                
            } catch (err) {
                alert("àª•à«…àª®à«‡àª°àª¾ àªàª•à«àª¸à«‡àª¸ àª®àª³à«àª¯à«àª‚ àª¨àª¥à«€: " + err.message);
            }
        }

        function stopCamera() {
            if(mediaStream) {
                mediaStream.getTracks().forEach(track => track.stop());
                mediaStream = null;
            }
            const vid = document.getElementById('cameraVideo');
            vid.srcObject = null;
            vid.classList.remove('active');
        }

        function switchCamera() {
            facingMode = facingMode === 'user' ? 'environment' : 'user';
            initCamera();
        }

        async function captureAndAnalyze() {
            const video = document.getElementById('cameraVideo');
            const canvas = document.getElementById('canvas');
            
            // Draw video frame to canvas
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Convert to Base64
            const base64Image = canvas.toDataURL('image/jpeg').split(',')[1];
            
            closeCamera(); // Close camera UI
            updateStatus("àªµàª¿àª¶à«àª²à«‡àª·àª£ àª¥àªˆ àª°àª¹à«àª¯à«àª‚ àª›à«‡...", "processing");
            
            // Call AI with Image
            // Note: Only Gemini supports image inline data in this simple setup
            if(currentProvider !== 'gemini') {
                speak("àª®àª¾àª« àª•àª°àªœà«‹, àª«à«‹àªŸà«‹ àªµàª¿àª¶à«àª²à«‡àª·àª£ àª®àª¾àªŸà«‡ àª•à«ƒàªªàª¾ àª•àª°à«€àª¨à«‡ Gemini àª®à«‹àª¡à«‡àª² àª¸àª¿àª²à«‡àª•à«àªŸ àª•àª°à«‹.");
                return;
            }

            const prompt = "àª† àª›àª¬à«€àª®àª¾àª‚ àª¶à«àª‚ àª›à«‡? àªœà«‹ àª¤à«‡àª®àª¾àª‚ àªªà«àª°àª¾àªšà«€àª¨ àª²àª¿àªªàª¿, àª¶àª¿àª²àª¾àª²à«‡àª– àª…àª¥àªµàª¾ àª¦àª¸à«àª¤àª¾àªµà«‡àªœ àª›à«‡, àª¤à«‹ àª¤à«‡àª¨à«‡ àªµàª¾àª‚àªšà«‹, àª—à«àªœàª°àª¾àª¤à«€àª®àª¾àª‚ àª­àª¾àª·àª¾àª‚àª¤àª° àª•àª°à«‹ àª…àª¨à«‡ àª¸àª®àªœàª¾àªµà«‹. àªœà«‹ àª¸àª¾àª®àª¾àª¨à«àª¯ àªµàª¸à«àª¤à« àª›à«‡ àª¤à«‹ àª¤à«‡àª¨à«€ àªµàª¿àª—àª¤à«‹ àª†àªªà«‹.";
            
            const response = await callGeminiVision(prompt, base64Image);
            
            speak(response);
        }

        // ==========================================
        // ğŸ§  AI LOGIC
        // ==========================================
        async function callAI(text, imageBase64 = null) {
            const key = API_KEYS[currentProvider];
            
            if(!key || key.includes('YOUR_')) {
                const err = "API Key àª•à«‹àª¡àª®àª¾àª‚ àª¸à«‡àªŸ àª¥àªˆ àª¨àª¥à«€. àª•à«ƒàªªàª¾ àª•àª°à«€àª¨à«‡ àª¸à«‡àªŸàª¿àª‚àª—à«àª¸ àªšà«‡àª• àª•àª°à«‹.";
                speak(err);
                return err;
            }

            try {
                if(currentProvider === 'groq' && !imageBase64) {
                    return await callGroq(text, key);
                } else if (currentProvider === 'gemini') {
                    return await (imageBase64 ? callGeminiVision(text, imageBase64, key) : callGeminiText(text, key));
                } else {
                    return "àª† àª«à«€àªšàª° àª† àª®à«‹àª¡à«‡àª²àª®àª¾àª‚ àª•àª¾àª® àª•àª°àª¤à«àª‚ àª¨àª¥à«€.";
                }
            } catch(e) {
                console.error(e);
                const errMsg = "àª­à«‚àª³ àª¥àªˆ àª—àªˆ: " + e.message;
                speak(errMsg);
                return errMsg;
            }
        }

        async function callGroq(text, key) {
            const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${key}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    model: currentModel,
                    messages: [
                        { role: "system", content: "àª¤àª®à«‡ àªàª• àª®àª¦àª¦àª°à«‚àªª àª…àª¸àª¿àª¸à«àªŸàª¨à«àªŸ àª›à«‹. àª—à«àªœàª°àª¾àª¤à«€àª®àª¾àª‚ àªŸà«‚àª‚àª•àª¾ àª…àª¨à«‡ àª¸à«àªªàª·à«àªŸ àªœàªµàª¾àª¬ àª†àªªà«‹." },
                        { role: "user", content: text }
                    ],
                    max_tokens: 300
                })
            });
            const data = await res.json();
            return data.choices?.[0]?.message?.content || "àªœàªµàª¾àª¬ àª®àª³à«àª¯à«‹ àª¨àª¥à«€";
        }

        async function callGeminiText(text, key) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${currentModel}:generateContent?key=${key}`;
            const res = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: text }] }]
                })
            });
            const data = await res.json();
            return data.candidates?.[0]?.content?.parts?.[0]?.text || "àªœàªµàª¾àª¬ àª®àª³à«àª¯à«‹ àª¨àª¥à«€";
        }

        async function callGeminiVision(text, imageBase64, key) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${currentModel}:generateContent?key=${key}`;
            const res = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ 
                        parts: [
                            { text: text },
                            { 
                                inline_data: {
                                    mime_type: "image/jpeg",
                                    data: imageBase64
                                }
                            }
                        ]
                    }]
                })
            });
            const data = await res.json();
            if(data.candidates?.[0]?.finishReason === 'SAFETY') return "àª† àª›àª¬à«€ àªµàª¿àª¶à«àª²à«‡àª·àª£ àª®àª¾àªŸà«‡ àª…àª¨à«àªªàª¯à«àª•à«àª¤ àª›à«‡.";
            return data.candidates?.[0]?.content?.parts?.[0]?.text || "àªµàª¿àª¶à«àª²à«‡àª·àª£ àª¥àªˆ àª¶àª•à«àª¯à«àª‚ àª¨àª¥à«€";
        }

        // ==========================================
        // ğŸ—£ï¸ VOICE & ACTION LOGIC
        // ==========================================
        function startVoice() {
            if(!('webkitSpeechRecognition' in window)) return alert("àª¬à«àª°àª¾àª‰àªàª° àª¸à«àªªà«€àªš àª¸àªªà«‹àª°à«àªŸ àª•àª°àª¤à«àª‚ àª¨àª¥à«€");
            
            const recognition = new webkitSpeechRecognition();
            recognition.lang = 'gu-IN';
            recognition.interimResults = false;
            
            recognition.onstart = () => {
                updateStatus("àª¸àª¾àª‚àª­àª³à«àª‚ àª›à«àª‚...", "listening");
                micBtn.classList.add('listening');
            };
            
            recognition.onend = () => {
                micBtn.classList.remove('listening');
                updateStatus("àªœàª¯ àª¶à«àª°à«€ àª•à«ƒàª·à«àª£", "idle");
            };
            
            recognition.onresult = async (e) => {
                const transcript = e.results[0][0].transcript;
                console.log("User said:", transcript);
                
                updateStatus("àªµàª¿àªšàª¾àª°à«€ àª°àª¹à«àª¯à«‹ àª›à«àª‚...", "processing");
                await processCommand(transcript);
            };
            
            recognition.start();
        }

        function stopAll() {
            window.speechSynthesis.cancel();
            updateStatus("àªœàª¯ àª¶à«àª°à«€ àª•à«ƒàª·à«àª£", "idle");
        }

        function speak(text) {
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(text);
            u.lang = 'gu-IN';
            u.rate = 1;
            u.onstart = () => updateStatus("àª¬à«‹àª²à«€ àª°àª¹à«àª¯à«‹ àª›à«àª‚...", "speaking");
            u.onend = () => updateStatus("àªœàª¯ àª¶à«àª°à«€ àª•à«ƒàª·à«àª£", "idle");
            window.speechSynthesis.speak(u);
        }

        // ==========================================
        // ğŸ§  SMART COMMAND PROCESSOR
        // ==========================================
        async function processCommand(text) {
            const lower = text.toLowerCase();

            // 1. Note Taking Logic (àª¨à«‹àª‚àª§ àª²àª–à«‹)
            if(lower.includes('àª¨à«‹àª‚àª§') || lower.includes('note')) {
                const noteText = text.replace(/àª¨à«‹àª‚àª§.*?àª²àª–à«‹|note.*?down/gi, '').trim();
                if(noteText.length > 0) {
                    saveNote(noteText);
                    speak("àª¨à«‹àª‚àª§ àª²àªˆ àª²à«€àª§à«€ àª›à«‡: " + noteText);
                } else {
                    speak("àª¶à«àª‚ àª²àª–àªµà«àª‚ àª›à«‡ àª•àª¹à«‹?");
                }
                return;
            }

            // 2. Call Logic (àª•à«‰àª² àª•àª°à«‹)
            if(lower.includes('àª•à«‰àª²') || lower.includes('call')) {
                const number = extractNumber(text);
                if(number) {
                    speak(number + " àªªàª° àª•à«‰àª² àª•àª°à«€ àª°àª¹à«àª¯à«‹ àª›à«àª‚");
                    setTimeout(() => window.location.href = `tel:${number}`, 2000);
                } else {
                    speak("àª•à«‰àª² àª•àª°àªµàª¾ àª®àª¾àªŸà«‡ àª¨àª‚àª¬àª° àª•àª¹à«‹");
                }
                return;
            }

            // 3. WhatsApp Logic (àªµà«‹àªŸà«àª¸àªàªª / whatsapp)
            if(lower.includes('àªµà«‹àªŸà«àª¸àªàªª') || lower.includes('whatsapp')) {
                const number = extractNumber(text);
                if(number) {
                    speak(number + " àª¨à«‡ àªµà«‹àªŸà«àª¸àªàªª àª–à«‹àª²à«€ àª°àª¹à«àª¯à«‹ àª›à«àª‚");
                    setTimeout(() => window.open(`https://wa.me/${number}`, '_blank'), 2000);
                } else {
                    speak("àªµà«‹àªŸà«àª¸àªàªª àª•àª°àªµàª¾ àª®àª¾àªŸà«‡ àª¨àª‚àª¬àª° àª•àª¹à«‹");
                }
                return;
            }

            // 4. General AI Query
            const response = await callAI(text);
            speak(response);
        }

        // Helper: Extract Phone Number (Supports Gujarati digits)
        function extractNumber(text) {
            // Map Gujarati digits to English
            const gujMap = {'à«¦':'0','à«§':'1','à«¨':'2','à«©':'3','à«ª':'4','à««':'5','à«¬':'6','à«­':'7','à«®':'8','à«¯':'9'};
            let normalized = text.split('').map(c => gujMap[c] || c).join('');
            
            // Regex for 10 digit number
            const match = normalized.match(/\d{10}/);
            return match ? match[0] : null;
        }

        // ==========================================
        // ğŸ“’ NOTE SYSTEM
        // ==========================================
        function saveNote(text) {
            const note = {
                text: text,
                date: new Date().toLocaleString('gu-IN')
            };
            notes.unshift(note);
            localStorage.setItem('myNotes', JSON.stringify(notes));
            showToast("Note Saved!");
        }

        function addManualNote() {
            const input = document.getElementById('manualNote');
            if(input.value.trim()) {
                saveNote(input.value.trim());
                input.value = '';
                renderNotes();
            }
        }

        function openNotes() {
            renderNotes();
            document.getElementById('notesModal').classList.add('active');
        }
        
        function toggleNotes() {
            document.getElementById('notesModal').classList.remove('active');
        }

        function renderNotes() {
            const container = document.getElementById('notesList');
            container.innerHTML = '';
            
            if(notes.length === 0) {
                container.innerHTML = '<div class="empty-notes">àª•à«‹àªˆ àª¨à«‹àª‚àª§ àª¨àª¥à«€</div>';
                return;
            }
            
            notes.forEach(n => {
                const div = document.createElement('div');
                div.className = 'note-item';
                div.innerHTML = `<span class="note-date">${n.date}</span> ${n.text}`;
                container.appendChild(div);
            });
        }

        // Init
        updateModels();
        setVideo('silent');

    </script>
</body>
</html>
